"use strict";function MiniSet(a){this.data={},this.add.apply(this,arguments)}angular.module("projectApp",["ngCookies","ngSanitize","ngTouch","patternfly","patternfly.charts","ui.bootstrap"]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0}]),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),MiniSet.prototype={add:function(){for(var a,b=0;b<arguments.length;b++)if(a=arguments[b],Array.isArray(a))for(var c=0;c<a.length;c++)this.data[a[c]]=a[c];else if(a instanceof MiniSet){var d=this;a.each(function(a,b){d.data[b]=a})}else this.data[a]=a;return this},_removeItem:function(a){delete this.data[a]},remove:function(a){for(var b,c=0;c<arguments.length;c++)if(b=arguments[c],Array.isArray(b))for(var d=0;d<b.length;d++)this._removeItem(b[d]);else this._removeItem(b);return this},has:function(a){return Object.prototype.hasOwnProperty.call(this.data,a)},isEmpty:function(){for(var a in this.data)if(this.has(a))return!1;return!0},keys:function(){var a=[];return this.each(function(b){a.push(b)}),a},clear:function(){return this.data={},this},each:function(a){return this.eachReturn(a),this},eachReturn:function(a){for(var b in this.data)if(this.has(b)&&a.call(this,this.data[b],b)===!1)return!1;return!0}},MiniSet.prototype.constructor=MiniSet,angular.module("projectApp").controller("TrelloCtrl",["$scope",function(a){a.boardFilter="",a.cards=[],a.num_cards_ok=0,a.num_cards_issues=0,a.num_cards_blocked=0,a.num_cards_total=0,a.cards_per_owner=new MiniSet,a.authorized=!1,a.full_name="N.N.",a.all_tags=new MiniSet,a.navbarCollapsed=!0,a.syseng_cards_chart_config={donut:{title:"Status",label:{show:!1},width:25},size:{height:130},legend:{show:!0},color:{pattern:["#3f9c35","#ec7a08","#cc0000"]},tooltip:{},data:{columns:[["ok",a.num_cards_ok],["issues",a.num_cards_issues],["blocked",a.num_cards_blocked]],type:"donut",groups:[["ok","issues","blocked"]]}},a.syseng_cards_data={ok:12,issues:3,blocked:1},a.eventText="";var b=function(b,c){a.eventText=b.name+" selected\n"+a.eventText},c=function(b,c){a.eventText=b.length+" items selected\n"+a.eventText},d=function(b,c){a.eventText=b.name+" clicked\n"+a.eventText},e=function(b,c){a.eventText=b.name+" double clicked\n"+a.eventText},f=function(b,c,d){a.eventText=b.name+" checked: "+b.selected+"\n"+a.eventText},g=function(b){return a.showDisabled&&"John Smith"===b.name};a.selectType="checkbox",a.updateSelectionType=function(){"checkbox"===a.selectType?(a.config.selectItems=!1,a.config.showSelectBox=!0):"row"===a.selectType?(a.config.selectItems=!0,a.config.showSelectBox=!1):(a.config.selectItems=!1,a.config.showSelectBox=!1)},a.showDisabled=!1,a.config={selectItems:!0,multiSelect:!1,dblClick:!1,selectionMatchProp:"name",selectedItems:[],checkDisabled:g,showSelectBox:!1,rowHeight:36,onSelect:b,onSelectionChange:c,onCheckBoxChange:f,onClick:d,onDblClick:e};var h=function(a){var b=/\[(.*?)\]/g,c=new MiniSet,d=a.name.match(b);return null!==d&&d.forEach(function(a,b,d){c.add(a.substring(1,a.length-1))}),c},i=function(a){return h(a).remove(j(a))},j=function(b){var c="";return a.all_tags=h(b),b.members.forEach(function(b){var d=b.username;a.all_tags.has(d)&&(c=d)}),c};a.get_data=function(){Trello.get("members/me/",function(b){a.full_name=b.fullName}),Trello.get("boards/"+boardId+"/lists",function(b){Trello.get("boards/"+boardId+"/cards?members=true",function(c){b.forEach(function(b){b.name.match(/!/)||c.forEach(function(c){if(!c.name.match(/!/)&&c.idList===b.id){var d=j(c),e="";a.num_cards_total+=1,console.log(c),c.labels.forEach(function(b,c,d){switch(b.name.toLowerCase()){case"ok":a.num_cards_ok+=1,e="success";break;case"issues":a.num_cards_issues+=1,e="warning";break;case"blocked":a.num_cards_blocked+=1,e="danger"}});var f={id:c.id,owner:d,title:c.name.replace("["+d+"]",""),url:c.shortUrl,description:c.desc,tags:i(c).keys(),status:e,dateLastActivity:new Date(c.dateLastActivity)};a.cards.push(f),console.log(f),a.syseng_cards_chart_config.data.columns=[["ok",a.num_cards_ok],["issues",a.num_cards_issues],["blocked",a.num_cards_blocked]],a.$apply()}})})})})};var k=function(){a.authorized=!0,a.get_data()};a.refresh=function(){a.get_data()},a.authorize=function(){Trello.authorize({type:"popup",name:"SysEng Reporting",success:k})},a.deauthorize=function(){Trello.deauthorize(),a.authorized=!1,a.cards=[],a.num_cards_ok=0,a.num_cards_issues=0,a.num_cards_blocked=0,a.num_cards_total=0,a.syseng_cards_chart_config.data.columns=[["ok",a.num_cards_ok],["issues",a.num_cards_issues],["blocked",a.num_cards_blocked]]}}]),angular.module("projectApp").run(["$templateCache",function(a){a.put("views/about.html","<p>This is a reporting tool for SysEng.</p>"),a.put("views/contact.html","<p>This is a contact page.</p>"),a.put("views/main.html",'<div class="row"> <div class="col-sm-8 col-md-9"> <div class="page-header page-header-bleed-right"> <div class="actions pull-right"> <a href="#"><span class="pficon pficon-refresh"></span> Refresh Results</a> </div> <h1><a href="https://trello.com/b/WZ2gjtnR/systems-engineering-projects-and-status">current assignments (WIP)</a></h1> </div> <div class="row"> <div class="col-sm-4"> <div id="syseng-chart"></div> </div> <div class="col-sm-4"> <div id="perfteam-chart"></div> </div> <div class="col-sm-4"> <div id="ux-chart"></div> </div> </div> <hr> <h2 class="h4">Tasks by Person</h2> <div id="output"> <table class="table"> <tr> <th>Status</th> <th>Location Data</th> <th>Hosts</th> </tr> <tr> <td><span class="label label-success">New</span></td> <td><strong>Fusce leo massa</strong><br>Created March 05, 2014 08:34:36 AM</td> <td><span class="label label-default">11</span></td> </tr> <tr> <td><span class="label label-success">New</span></td> <td><strong>Iaculis at dapibus eget</strong><br>Created March 03, 2014 20:32:12 AM</td> <td><span class="label label-default">9</span></td> </tr> <tr> <td><span class="label label-default">Disabled</span></td> <td><strong>Dapibus nec metus</strong><br>Created March 03, 2014 19:11:56 AM</td> <td><span class="label label-default">25</span></td> </tr> </table> </div><!-- output --> <hr> </div><!-- /col --> <div class="col-sm-4 col-md-3 sidebar-pf sidebar-pf-right"> <div class="sidebar-header sidebar-header-bleed-left sidebar-header-bleed-right"> <div class="actions pull-right"> <a href="#">Clear Messages</a> </div> <h2 class="h5">Latest Notifications</h2> </div> <p><a href="#">See all messages</a></p> </div><!-- /col --> </div><!-- /row -->')}]);